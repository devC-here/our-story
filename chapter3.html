<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chapter 3 - A Special Name</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Patrick+Hand&family=Kalam:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Patrick Hand", cursive;
        background: linear-gradient(
          135deg,
          #1a0030 0%,
          #3d0060 50%,
          #7200a8 100%
        );
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        touch-action: none;
        color: #fff;
      }

      .container {
        max-width: 800px;
        width: 100%;
        text-align: center;
      }

      .header {
        margin-bottom: 30px;
      }

      .title {
        font-family: "Caveat", cursive;
        font-size: clamp(2rem, 6vw, 3.5rem);
        font-weight: 700;
        color: #f0c8ff;
        text-shadow:
          2px 2px 0 rgba(114, 0, 168, 0.5),
          0 0 30px rgba(240, 200, 255, 0.5);
        margin-bottom: 10px;
      }

      .hint {
        font-family: "Kalam", cursive;
        font-size: clamp(1rem, 3vw, 1.3rem);
        color: #d880f8;
        font-style: italic;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      #status {
        font-family: "Caveat", cursive;
        font-size: clamp(1.3rem, 4vw, 2rem);
        font-weight: 700;
        min-height: 2.5em;
        color: #f0c8ff;
        margin-bottom: 20px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
      }

      #status.success {
        color: #4caf50;
        font-size: clamp(1.5rem, 5vw, 2.5rem);
        text-shadow: 0 0 20px rgba(76, 175, 80, 0.6);
      }

      #status.checking {
        color: #ffd700;
        animation: pulse 1s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 0.7;
        }
        50% {
          opacity: 1;
        }
      }

      .canvas-container {
        position: relative;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 16px;
        padding: 15px;
        box-shadow:
          0 10px 40px rgba(0, 0, 0, 0.3),
          inset 0 0 20px rgba(180, 64, 216, 0.1);
        margin-bottom: 25px;
        overflow: hidden;
      }

      .canvas-snow-container {
        position: absolute;
        inset: 15px;
        pointer-events: none;
        z-index: 10;
        border-radius: 12px;
        overflow: hidden;
        background: rgba(255, 182, 193, 0.15); /* Base frost layer */
      }

      canvas {
        width: 100%;
        height: auto;
        border-radius: 12px;
        background: #fff;
        cursor: crosshair;
        touch-action: none;
        position: relative;
        z-index: 5;
      }

      .controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        flex-wrap: wrap;
      }

      button {
        font-family: "Patrick Hand", cursive;
        padding: 12px 30px;
        font-size: clamp(0.9rem, 2.5vw, 1.1rem);
        border: 2px solid rgba(180, 64, 216, 0.5);
        border-radius: 50px;
        background: rgba(60, 0, 100, 0.4);
        backdrop-filter: blur(10px);
        color: #f0c8ff;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      }

      button:hover {
        background: rgba(114, 0, 168, 0.5);
        border-color: #b040d8;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(180, 64, 216, 0.4);
      }

      button:active {
        transform: translateY(0);
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* HEAVY deep pink-reddish snow - car windshield frost effect */
      .snow {
        position: absolute;
        border-radius: 50%;
        pointer-events: none;
        animation: snowfall linear infinite;
      }

      /* Deep pink-red colors like frost */
      .snow.frost1 {
        background: radial-gradient(
          circle,
          rgba(255, 105, 145, 0.95) 0%,
          rgba(255, 140, 170, 0.85) 50%,
          rgba(255, 182, 193, 0.6) 100%
        );
        box-shadow:
          0 0 8px rgba(255, 105, 145, 0.8),
          inset -2px -2px 6px rgba(255, 182, 193, 0.9),
          inset 2px 2px 4px rgba(255, 255, 255, 0.5);
        filter: blur(0.5px);
      }

      .snow.frost2 {
        background: radial-gradient(
          circle,
          rgba(255, 130, 160, 0.9) 0%,
          rgba(255, 160, 180, 0.8) 50%,
          rgba(255, 192, 203, 0.5) 100%
        );
        box-shadow:
          0 0 10px rgba(255, 130, 160, 0.9),
          inset -3px -3px 8px rgba(255, 200, 210, 0.8),
          inset 1px 1px 5px rgba(255, 255, 255, 0.6);
        filter: blur(0.8px);
      }

      .snow.frost3 {
        background: radial-gradient(
          ellipse,
          rgba(255, 120, 150, 1) 0%,
          rgba(255, 150, 170, 0.9) 40%,
          rgba(255, 180, 195, 0.6) 100%
        );
        box-shadow:
          0 0 12px rgba(255, 120, 150, 0.95),
          inset -2px -2px 7px rgba(255, 190, 200, 0.9),
          inset 2px 2px 6px rgba(255, 240, 245, 0.7);
        filter: blur(1px);
      }

      .snow.frost4 {
        background: radial-gradient(
          circle,
          rgba(255, 140, 165, 0.95) 0%,
          rgba(255, 170, 185, 0.85) 50%,
          rgba(255, 200, 210, 0.55) 100%
        );
        box-shadow:
          0 0 6px rgba(255, 140, 165, 0.9),
          inset -1px -1px 5px rgba(255, 180, 190, 0.85),
          inset 1px 1px 3px rgba(255, 255, 255, 0.4);
        filter: blur(0.6px);
      }

      /* Larger frost clusters for dense coverage */
      .snow.cluster {
        background: radial-gradient(
          ellipse,
          rgba(255, 120, 155, 0.9) 0%,
          rgba(255, 150, 175, 0.8) 30%,
          rgba(255, 180, 195, 0.6) 70%,
          rgba(255, 210, 220, 0.3) 100%
        );
        box-shadow:
          0 0 15px rgba(255, 120, 155, 0.9),
          inset -4px -4px 10px rgba(255, 180, 195, 0.9),
          inset 3px 3px 8px rgba(255, 240, 245, 0.7);
        filter: blur(1.5px);
        border-radius: 40% 60% 50% 70%;
      }

      @keyframes snowfall {
        0% {
          transform: translateY(-20px) translateX(0) rotate(0deg);
          opacity: 0;
        }
        5% {
          opacity: 1;
        }
        95% {
          opacity: 0.95;
        }
        100% {
          transform: translateY(110%) translateX(20px) rotate(180deg);
          opacity: 0;
        }
      }

      /* Static frost patches that don't move - for windshield effect */
      .static-frost {
        position: absolute;
        pointer-events: none;
        border-radius: 50%;
        animation: none !important;
      }

      /* Heart trail particles */
      .heart-trail {
        position: fixed;
        pointer-events: none;
        z-index: 15;
        animation: heartTrailFloat 1.8s ease-out forwards;
      }

      @keyframes heartTrailFloat {
        0% {
          transform: scale(1) rotate(0deg);
          opacity: 0.9;
        }
        100% {
          transform: scale(0) rotate(45deg) translateY(-50px);
          opacity: 0;
        }
      }

      /* Success overlay */
      .success-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.7);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 2000;
        animation: fadeIn 0.5s ease;
      }

      .success-overlay.show {
        display: flex;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .success-message {
        background: linear-gradient(135deg, #7200a8, #b040d8);
        padding: 40px;
        border-radius: 20px;
        text-align: center;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        transform: scale(0);
        animation: successPop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275) 0.3s
          forwards;
      }

      @keyframes successPop {
        0% {
          transform: scale(0) rotate(-180deg);
        }
        70% {
          transform: scale(1.1) rotate(10deg);
        }
        100% {
          transform: scale(1) rotate(0deg);
        }
      }

      .success-message h2 {
        font-family: "Caveat", cursive;
        font-size: clamp(2rem, 6vw, 3.5rem);
        font-weight: 700;
        color: #fff;
        margin-bottom: 20px;
        text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      }

      .success-message p {
        font-family: "Kalam", cursive;
        font-size: clamp(1rem, 3vw, 1.4rem);
        color: #f0c8ff;
        line-height: 1.6;
      }

      /* Mobile optimization */
      @media (max-width: 768px) {
        body {
          padding: 15px;
        }

        .canvas-container {
          padding: 10px;
        }

        .controls {
          gap: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1 class="title">A Special Name üíú</h1>
        <p class="hint">Guess and write what I love to call you...</p>
      </div>

      <div id="status">Write with your finger ‚ú®</div>

      <div class="canvas-container">
        <canvas id="pad" width="700" height="350"></canvas>
        <div class="canvas-snow-container" id="canvas-snow"></div>
      </div>

      <div class="controls">
        <button onclick="clearAll()" id="clear-btn">
          üîÑ Clear & Try Again
        </button>
      </div>
    </div>

    <!-- Success overlay -->
    <div class="success-overlay" id="success-overlay">
      <div class="success-message">
        <h2>You got it! üíú</h2>
        <p>Yes, you're my Disha ‚ú®<br />My light in the darkness</p>
      </div>
    </div>

    <script>
      const canvas = document.getElementById("pad");
      const ctx = canvas.getContext("2d");
      const status = document.getElementById("status");
      const successOverlay = document.getElementById("success-overlay");
      const canvasSnowContainer = document.getElementById("canvas-snow");
      const clearBtn = document.getElementById("clear-btn");

      // Google Vision API Key (hidden in background)
      const API_KEY = "AIzaSyD1NV-GbpEf-5oyuOdb9b-NJcBv_Kz4W7Q";

      let drawing = false;
      let currentPoints = [];
      let recognitionTimeout = null;
      let isChecking = false;

      // Initialize Canvas with THICK line
      ctx.strokeStyle = "#7200a8";
      ctx.lineWidth = 10;
      ctx.lineCap = "round";
      ctx.lineJoin = "round";

      // Create STATIC frost patches (like on car windshield - don't move)
      function createStaticFrost() {
        const frost = document.createElement("div");
        frost.className = "snow static-frost";

        const types = ["frost1", "frost2", "frost3", "frost4", "cluster"];
        frost.classList.add(types[Math.floor(Math.random() * types.length)]);

        // MUCH larger sizes for thick coverage
        const size = 15 + Math.random() * 40; // 15-55px (BIG)
        frost.style.width = size + "px";
        frost.style.height = size + "px";
        frost.style.left = Math.random() * 100 + "%";
        frost.style.top = Math.random() * 100 + "%";
        frost.style.opacity = 0.7 + Math.random() * 0.3; // High opacity for coverage

        canvasSnowContainer.appendChild(frost);
      }

      // Create DENSE static frost coverage (like car windshield)
      for (let i = 0; i < 150; i++) {
        // LOTS of static frost
        createStaticFrost();
      }

      // Create falling deep pink snow particles for movement
      function createFallingSnow() {
        const snow = document.createElement("div");
        snow.className = "snow";

        const types = ["frost1", "frost2", "frost3", "frost4", "cluster"];
        snow.classList.add(types[Math.floor(Math.random() * types.length)]);

        const size = 8 + Math.random() * 25; // 8-33px
        snow.style.width = size + "px";
        snow.style.height = size + "px";
        snow.style.left = Math.random() * 100 + "%";
        snow.style.top = "-30px";
        snow.style.animationDuration = 6 + Math.random() * 10 + "s";
        snow.style.animationDelay = Math.random() * 3 + "s";
        snow.style.opacity = 0.75 + Math.random() * 0.25;

        canvasSnowContainer.appendChild(snow);

        setTimeout(() => snow.remove(), 17000);
      }

      // Continuous heavy snowfall
      setInterval(createFallingSnow, 50); // Very frequent
      for (let i = 0; i < 120; i++) {
        setTimeout(createFallingSnow, i * 25);
      }

      // Background frost too
      function createBackgroundFrost() {
        const frost = document.createElement("div");
        frost.className = "snow";
        frost.style.position = "fixed";
        frost.style.zIndex = "1";

        const types = ["frost1", "frost2", "frost3", "frost4", "cluster"];
        frost.classList.add(types[Math.floor(Math.random() * types.length)]);

        const size = 10 + Math.random() * 30;
        frost.style.width = size + "px";
        frost.style.height = size + "px";
        frost.style.left = Math.random() * 100 + "%";
        frost.style.top = "-30px";
        frost.style.animationDuration = 8 + Math.random() * 14 + "s";
        frost.style.animationDelay = Math.random() * 4 + "s";
        frost.style.opacity = 0.6 + Math.random() * 0.4;

        document.body.appendChild(frost);

        setTimeout(() => frost.remove(), 22000);
      }

      setInterval(createBackgroundFrost, 80);
      for (let i = 0; i < 80; i++) {
        setTimeout(createBackgroundFrost, i * 40);
      }

      // Event Handlers
      const getXY = (e) => {
        const r = canvas.getBoundingClientRect();
        const t = e.touches ? e.touches[0] : e;
        return {
          x: (t.clientX - r.left) * (canvas.width / r.width),
          y: (t.clientY - r.top) * (canvas.height / r.height),
        };
      };

      canvas.addEventListener("mousedown", startDrawing);
      canvas.addEventListener("touchstart", startDrawing);
      window.addEventListener("mousemove", draw);
      window.addEventListener("touchmove", draw);
      window.addEventListener("mouseup", stopDrawing);
      window.addEventListener("touchend", stopDrawing);

      function startDrawing(e) {
        e.preventDefault();
        drawing = true;
        currentPoints = [getXY(e)];
        ctx.beginPath();

        if (recognitionTimeout) {
          clearTimeout(recognitionTimeout);
          recognitionTimeout = null;
        }
      }

      function draw(e) {
        if (!drawing) return;
        e.preventDefault();
        const p = getXY(e);
        ctx.lineTo(p.x, p.y);
        ctx.stroke();
        currentPoints.push(p);

        if (currentPoints.length % 5 === 0) {
          createHeartTrail(p.x, p.y);
        }
      }

      function stopDrawing() {
        if (!drawing) return;
        drawing = false;

        if (recognitionTimeout) {
          clearTimeout(recognitionTimeout);
        }

        recognitionTimeout = setTimeout(() => {
          recognizeHandwriting();
        }, 4500); // 4.5 seconds

        currentPoints = [];
      }

      function createHeartTrail(canvasX, canvasY) {
        const rect = canvas.getBoundingClientRect();
        const screenX = rect.left + (canvasX / canvas.width) * rect.width;
        const screenY = rect.top + (canvasY / canvas.height) * rect.height;

        const heart = document.createElement("div");
        heart.className = "heart-trail";
        heart.innerHTML = "üíó";
        heart.style.left = screenX + "px";
        heart.style.top = screenY + "px";
        heart.style.fontSize = 10 + Math.random() * 14 + "px";

        document.body.appendChild(heart);
        setTimeout(() => heart.remove(), 1800);
      }

      async function recognizeHandwriting() {
        if (isChecking) return;

        isChecking = true;
        status.innerText = "Checking... ‚ú®";
        status.classList.add("checking");
        clearBtn.disabled = true;

        try {
          const imageData = canvas.toDataURL("image/png").split(",")[1];

          const response = await fetch(
            `https://vision.googleapis.com/v1/images:annotate?key=${API_KEY}`,
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                requests: [
                  {
                    image: {
                      content: imageData,
                    },
                    features: [
                      {
                        type: "DOCUMENT_TEXT_DETECTION",
                        maxResults: 1,
                      },
                    ],
                  },
                ],
              }),
            },
          );

          const data = await response.json();

          if (data.responses && data.responses[0].fullTextAnnotation) {
            const detectedText = data.responses[0].fullTextAnnotation.text
              .toLowerCase()
              .trim()
              .replace(/\s+/g, "");

            console.log("Detected:", detectedText);

            if (detectedText === "disha" || detectedText.includes("disha")) {
              celebrateSuccess();
            } else {
              status.innerText = "Not quite... Try again! üíú";
              status.classList.remove("checking");
            }
          } else {
            status.innerText = "Couldn't read that. Try writing clearer! ‚úçÔ∏è";
            status.classList.remove("checking");
          }
        } catch (error) {
          console.error("Recognition error:", error);
          status.innerText = "Something went wrong. Try again! üîÑ";
          status.classList.remove("checking");
        }

        isChecking = false;
        clearBtn.disabled = false;
      }

      function celebrateSuccess() {
        status.innerText = "‚ú® Perfect! You got it! ‚ú®";
        status.classList.remove("checking");
        status.classList.add("success");

        for (let i = 0; i < 60; i++) {
          setTimeout(() => {
            createConfetti();
          }, i * 25);
        }

        setTimeout(() => {
          successOverlay.classList.add("show");
        }, 1000);
      }

      function createConfetti() {
        const colors = [
          "#ff6b9d",
          "#b040d8",
          "#ffd700",
          "#4caf50",
          "#f0c8ff",
          "#ff8ca8",
        ];
        const confetti = document.createElement("div");

        confetti.style.position = "fixed";
        confetti.style.width = 6 + Math.random() * 12 + "px";
        confetti.style.height = 6 + Math.random() * 12 + "px";
        confetti.style.background =
          colors[Math.floor(Math.random() * colors.length)];
        confetti.style.left = Math.random() * 100 + "%";
        confetti.style.top = "-20px";
        confetti.style.borderRadius = Math.random() > 0.5 ? "50%" : "2px";
        confetti.style.zIndex = "1000";
        confetti.style.pointerEvents = "none";

        document.body.appendChild(confetti);

        confetti.animate(
          [
            {
              top: "-20px",
              transform: "rotate(0deg)",
              opacity: 1,
            },
            {
              top: "100vh",
              transform: `rotate(${360 + Math.random() * 360}deg)`,
              opacity: 0,
            },
          ],
          {
            duration: 2000 + Math.random() * 1500,
            easing: "cubic-bezier(0.25, 0.46, 0.45, 0.94)",
          },
        );

        setTimeout(() => confetti.remove(), 3500);
      }

      function clearAll() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (recognitionTimeout) {
          clearTimeout(recognitionTimeout);
          recognitionTimeout = null;
        }

        status.innerText = "Write with your finger ‚ú®";
        status.classList.remove("success", "checking");
        successOverlay.classList.remove("show");
      }

      setTimeout(() => {
        status.innerText = "Guess the name I call you üíú";
      }, 1500);
    </script>
  </body>
</html>
